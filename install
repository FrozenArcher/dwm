#!/bin/sh

_dwm_dir="./dwm-src"

if [ ! -d "$_dwm_dir" ]; then
	echo "dwm directory \"$_dwm_dir\" not found."
	exit 1
fi

if [[ "$1" == "clean" ]]; then
	cd $_dwm_dir
	make clean
	exit 0
fi

if [ $(id -u) -ne 0 ]; then
	echo "Please run as root."
	exit 1
fi

cd $_dwm_dir
echo "==> Installing dwm..."
echo " --- dwm ---" > ../make.log
make >> ../make.log
echo " --- dwm install ---" >> ../make.log
make install >> ../make.log
echo " --- DONE --- " >> ../make.log
echo "==> Done"
cd ..

echo "==> Installing files..."

xsessions_dir="/usr/share/xsessions"
local_bin_dir="/usr/local/bin"

if [ ! -d "$xsessions_dir" ]; then
    echo "$xsessions_dir not found."
	mkdir -pv "$xsessions_dir"
fi
cp -fv ./dwm.desktop $xsessions_dir/dwm.desktop
chmod -v 644 $xsessions_dir/dwm.desktop

if [ ! -d "$local_bin_dir" ]; then
    echo "$local_bin_dir not found."
	mkdir -pv "$local_bin_dir"
fi
cp -fv ./launch_dwm $local_bin_dir/launch_dwm
chmod -v 755 $local_bin_dir/launch_dwm 
